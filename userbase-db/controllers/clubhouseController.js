import express from "express";
const app = express();
import { body, validationResult } from "express-validator";
import { gameCardSchema, genreSchema } from "../constants/gameFormSchema.js";
import { addRowToTable, addToTable, deleteFromTable, selectFromTable } from "../db/queries.js";
import pool from "../db/pool.js";
import { tableMap } from "../db/tableMap.js";
import { updateInTable } from "../db/queries.js";
import { commentFormSchema } from "../constants/commentFormSchema.js";

/* –ê–õ–ì–û–†–ò–¢–ú –û–¢–†–ò–°–û–í–ö–ò –ü–û–õ–ï–ô –ê–í–¢–û–† –∏ CREATED_AT –≤ –ó–ê–í–ò–°–ò–ú–û–°–¢–ò –û–¢ –°–¢–ê–¢–£–°–ê –Æ–ó–ï–†–ê

1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –≤–≤–µ–¥–µ–Ω–æ —Å–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–ª–æ–≤–æ
2. –ï—Å–ª–∏ –¥–∞ - –æ–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–æ–Ω–∫—É –≤ –±–¥ –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è isMember = true
3. –î–∞–ª–µ–µ –º–Ω–µ –Ω—É–∂–Ω–æ –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø –∫ —ç—Ç–æ–º—É —Å–≤–æ–π—Å—Ç–≤—É –≤ —Å–µ—Å—Å–∏–∏, —á—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –ø–æ–ª—è –∞–≤—Ç–æ—Ä–∞ –∏ created at? –ï—Å–ª–∏ –¥–∞, —Ç–æ –∫–∞–∫ —Ç—É–¥–∞ –¥–æ–±–∞–≤–∏—Ç—å? –ò–ª–∏ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –≤ –±–∞–∑—É –ø–µ—Ä–µ–¥ –æ—Ç—Ä–∏—Å–æ–≤–∫–æ–π —ç—Ç–∏—Ö –ø–æ–ª–µ–π –∏ –∏—Å–∫–∞—Ç—å —Ç–∞–º —Ñ–ª–∞–≥ isMember?
4. –û—Ç—Ä–∏—Å–æ–≤–∞–µ–º –ø–æ–ª—è –≤ —à–∞–±–ª–æ–Ω–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –º–µ–º–±–µ—Ä–∞:

if (key === 'author' || key === 'created_at') {
    if (user.isMember) {
    <%= commentFormSchema[key].label %>: <%- comment[key] %> 
    } else { return }
} else {
    }
*/


app.use(express.urlencoded({ extended: true }));

//RENDER COMMENTS LIST
export const renderCommentsGet = async (req, res) => {
    const comments = (
        await pool.query(`
        SELECT users.username, comments.comment_id, comments.content, comments.created_at
        FROM users JOIN comments 
        ON users.id = comments.author_id`)
    ).rows;

    // console.log('üöÄ ~ renderCommentsGet ~ comments:', comments);

    // console.log("üöÄ ~ renderCommentsGet ~ comments:", comments);
    // console.log('üöÄ ~ renderCommentsGet ~ req.user:', req.user);

    // console.log('üöÄ ~ renderCommentsGet ~ res.locals.user:', res.locals.user);

    res.render('comments-list', {
        comments,
        commentFormSchema,
        // user: req.user //TODO: –ø–æ—á–µ–º—É –±–µ–∑ —è–≤–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ user req user –Ω–µ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è Username?
    });
}

//ADD COMMENT
export const addCommentGet = (req, res) => {

}

export const addCommentPost = async (req, res) => {

}

//VERIFY MEMBERSHIP
export const verifyMembershipGet = async (req, res) => {

}

export const verifyMembershipPost = async (req, res) => {

}